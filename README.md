# Clhoria åŸºäº Hono çš„å¿«é€Ÿå¼€å‘æ¨¡æ¿

ç®€ä½“ä¸­æ–‡ | [English](./readme.en.md)

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Node](https://img.shields.io/badge/node-%3E%3D24-brightgreen.svg)
![TypeScript](https://img.shields.io/badge/typescript-5.9+-blue.svg)
![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)

ç°ä»£åŒ–ä¼ä¸šçº§åç«¯æ¨¡æ¿,åŸºäº Hono æ¡†æ¶æ„å»ºçš„é«˜æ€§èƒ½ TypeScript åº”ç”¨ã€‚é‡‡ç”¨ AI é©±åŠ¨å¼€å‘æ¨¡å¼,ç»“åˆ Hono + OpenAPI + Zod å®Œæ•´æŠ€æœ¯ä½“ç³»,å®ç°çœŸæ­£çš„ç±»å‹å®‰å…¨å’Œå¼€å‘æ•ˆç‡æå‡ã€‚é›†æˆ Drizzle ORM + PostgreSQL æ•°æ®å±‚,å®Œæ•´çš„ RBAC æƒé™ä½“ç³»,æä¾›æ¯”ä¼ ç»Ÿåå°ç®¡ç†ç³»ç»Ÿæ›´ç¨³å®šã€æ›´é«˜æ•ˆçš„å¼€å‘ä½“éªŒã€‚

Clhoria å°†å¤æ‚çš„æŠ€æœ¯æ¶æ„åŒ–ç¹ä¸ºç®€,è®©æ¯ä¸€æ¬¡ç¼–ç éƒ½å¦‚è¯—èˆ¬ä¼˜é›…,æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½å¦‚èŠ±èˆ¬ç»½æ”¾ã€‚é€‰æ‹© Clhoria,å°±æ˜¯é€‰æ‹©ä¸æœªæ¥åŒè¡Œã€‚

> æ¨¡æ¿é…å¥—çš„åå°ç®¡ç†å‰ç«¯éƒ¨åˆ†åŸºäº Refine + Shadcn å¼€å‘:[https://github.com/zhe-qi/refine-project](https://github.com/zhe-qi/refine-project)

## åŠŸèƒ½ç‰¹æ€§

- **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: Hono + TypeScript + Vite + Drizzle ORM + PostgreSQL
- **æ¸è¿›å¼åˆ†å±‚**: å‡½æ•°å¼å¼€å‘è§„èŒƒã€å¤šå±‚çº§è·¯ç”±ç»“æ„ã€å¤æ‚ä¸šåŠ¡å¯é€‰DDD
- **è‡ªåŠ¨åŒ–æ–‡æ¡£**: OpenAPI 3.1 è§„èŒƒ + Scalar UI,ä»£ç å³æ–‡æ¡£,æ”¯æŒåœ¨çº¿è°ƒè¯•å’Œç±»å‹ç”Ÿæˆ
- **å¤šå±‚è®¤è¯æˆæƒ**: JWT åŒå¯†é’¥(Admin/Client éš”ç¦»)+ Casbin RBAC + KeyMatch3 RESTful,æ— éœ€å­˜å‚¨æƒé™æ ‡è¯†
- **å£°æ˜å¼åˆ†é¡µå™¨**: åŸºäº Refine è§„èŒƒçš„å®‰å…¨å£°æ˜å¼æŸ¥è¯¢,æ‹“å±• refine æŸ¥è¯¢æ”¯æŒä»…åç«¯è”è¡¨æŸ¥è¯¢
- **å®Œæ•´æƒé™ä½“ç³»**: ç”¨æˆ·ç®¡ç† + è§’è‰²ç®¡ç† + Casbin æƒé™ç­–ç•¥ + Refine Resource ç¼–è¯‘æ—¶èœå•è·¯ç”±,é›¶è¿è¡Œæ—¶å¼€é”€
- **ä¸šåŠ¡å’Œç³»ç»Ÿå­—å…¸**: ä¸šåŠ¡å­—å…¸æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€é…ç½®(JSONB + Redisç¼“å­˜),ç³»ç»Ÿå­—å…¸ä½¿ç”¨Pgæšä¸¾ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- **æ—¥å¿—ä¸­é—´ä»¶**: æ”¶é›†æ—¥å¿—,æ”¯æŒå¤šç§å­˜å‚¨æ–¹æ¡ˆ(é˜¿é‡Œäº‘ SLSã€PostgreSQL TimescaleDBã€Loki ç­‰)
- **é«˜æ€§èƒ½ç¼“å­˜**: Redis ç¼“å­˜ï¼ˆæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼‰+ å¤šå±‚é™æµç­–ç•¥ + æƒé™ç¼“å­˜ + ä¼šè¯ç®¡ç† + åˆ†å¸ƒå¼é”
- **ä»»åŠ¡é˜Ÿåˆ—å’Œå®šæ—¶ä»»åŠ¡**: åŸºäº pg-boss çš„åå°ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†å’Œå®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼ˆåˆ†å¸ƒå¼å®‰å…¨ï¼Œå¤šèŠ‚ç‚¹åªæ‰§è¡Œä¸€æ¬¡ï¼‰
- **åˆ†å¸ƒå¼äº‹åŠ¡**: åŸºäº pg-boss çš„ Saga åè°ƒå™¨ï¼Œæ”¯æŒå¤šæ­¥éª¤äº‹åŠ¡ã€è‡ªåŠ¨è¡¥å¿å›æ»šã€é‡è¯•ç­–ç•¥ã€è¶…æ—¶å¤„ç†
- **å‡½æ•°å¼åŸºç¡€è®¾æ–½**: åŸºäº Effect-TS æ„å»ºåŸºç¡€è®¾æ–½å±‚ï¼Œç±»å‹å®‰å…¨çš„ä¾èµ–æ³¨å…¥ã€å¯ç»„åˆçš„é”™è¯¯å¤„ç†ã€ç»“æ„åŒ–å¹¶å‘
- **å¯¹è±¡å­˜å‚¨**: é›†æˆ S3 å…¼å®¹å¯¹è±¡å­˜å‚¨(æ”¯æŒ Cloudflare R2ã€é˜¿é‡Œäº‘ OSSã€AWS S3 ç­‰)
- **æ™ºèƒ½éªŒè¯ç **: é›†æˆ Cap.js,åŸºäº SHA-256 å·¥ä½œé‡è¯æ˜çš„è½»é‡çº§ç°ä»£éªŒè¯ç ,éšç§å‹å¥½æ— è¿½è¸ª
- **ç±»å‹å®‰å…¨ä½“ç³»**: Hono + Zod + TypeScript å…¨é“¾è·¯ç±»å‹æ¨å¯¼,ç¼–è¯‘æ—¶å‘ç°é—®é¢˜
- **å³æ—¶åé¦ˆå¼€å‘**: åŸºäº Vite çš„çƒ­é‡è½½å¼€å‘ç¯å¢ƒ,ä»£ç å˜æ›´æ¯«ç§’çº§ç”Ÿæ•ˆ,å¼€å‘ä½“éªŒæè‡´æµç•…
- **å£°æ˜å¼ DSL æ¶æ„**: `defineConfig` é…ç½®é©±åŠ¨åº”ç”¨ç»„è£…,`defineMiddleware` å£°æ˜ä¸­é—´ä»¶é“¾,å…¥å£æ–‡ä»¶ç®€æ´
- **AI é©±åŠ¨å¼€å‘**: Claude Code + CLAUDE.md + MCP æ’ä»¶ç”Ÿæ€,AI ç†è§£é¡¹ç›®æ¶æ„,è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹(Vitest)
- **ç›‘æ§ç³»ç»Ÿ**: é›†æˆ Sentry é”™è¯¯è¿½è¸ª,æ”¯æŒè‡ªå»ºæˆ–äº‘åŸç”Ÿæ–¹æ¡ˆ(å°å›¢é˜Ÿæ¨èäº‘æœåŠ¡,å…è¿ç»´)
- **Excel å¤„ç†**: åŸºäº excelize-wasm çš„é«˜æ€§èƒ½ Excel å¤„ç†ï¼Œå•ä¾‹å»¶è¿ŸåŠ è½½ï¼Œgolang åŒæ¬¾

## å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

- Node.js >= 24(å»ºè®®ä½¿ç”¨latest)
- pnpm >= 10(æ ¹æ®package.jsoné‡Œçš„packageManagerç‰ˆæœ¬å·æ¥å³å¯)
- PostgreSQL >= 18(å¦‚æœä½¿ç”¨17è¯·å‚è€ƒreadmeä¸­çš„é™çº§æŒ‡å—å¾ˆè½»æ¾çš„é™çº§)
- Redis >= 7(è¿™ä¸ªæ— æ‰€è°“ï¼Œ7æˆ–è€…latestéƒ½è¡Œ)

#### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

   ```bash
   git clone https://github.com/zhe-qi/clhoria-template
   cd clhoria-template
   ```

2. **å®‰è£…ä¾èµ–**

   ```bash
   npm i -g corepack
   pnpm install
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**

   ```bash
   cp .env.example .env
   ```

4. **åˆå§‹åŒ–æ•°æ®åº“**

   ```bash
   # å¯åŠ¨postgresæœåŠ¡(å¯é€‰,åœ¨æœ¬åœ°dockerç¯å¢ƒä¸‹å¿«é€Ÿæ­å»ºpostgresæ•°æ®åº“)
   docker compose --env-file .env run -d --service-ports postgres

   # å¯åŠ¨redisæœåŠ¡(å¯é€‰,åœ¨æœ¬åœ°dockerç¯å¢ƒä¸‹å¿«é€Ÿæ­å»ºredis)
   docker compose --env-file .env run -d --service-ports redis

   # æ‰§è¡Œæ•°æ®åº“è¿ç§»(å¼€å‘ç¯å¢ƒå¿«é€Ÿè¿­ä»£è¯·ç›´æ¥ä½¿ç”¨ pnpm pushï¼Œå°½å¯èƒ½ä¿è¯ generate å’Œ migrate ç”¨åœ¨é‡è¦èŠ‚ç‚¹)
   pnpm migrate

   # å¡«å……åˆå§‹æ•°æ®(å¯é€‰,åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶åˆå§‹åŒ–)
   npm install -g bun
   pnpm seed
   ```

   **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**éœ€è¦å…ˆéªŒè¯è¿ç§»:

   ```bash
   pnpm generate  # ç”Ÿæˆè¿ç§»æ–‡ä»¶
   pnpm migrate   # æ‰§è¡Œè¿ç§»
   ```

5. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
   ```bash
   pnpm dev
   ```

è®¿é—® <http://localhost:9999> æŸ¥çœ‹ API æ–‡æ¡£ã€‚

## TypeScript 5.9+ å’Œ ts-go æ”¯æŒ

æœ¬é¡¹ç›®æ”¯æŒä½¿ç”¨å®éªŒæ€§çš„ ts-go æ¥æå‡ TypeScript çš„ç±»å‹æ£€æŸ¥å’Œè¯­è¨€æœåŠ¡æ€§èƒ½ã€‚åœ¨å½“å‰é¡¹ç›®è§„æ¨¡ä¸‹ï¼Œts-go çš„æ€§èƒ½æå‡éå¸¸æ˜æ˜¾ï¼Œä¸”è¯­è¨€æœåŠ¡ç›¸å¯¹ç¨³å®šï¼Œæ¨èä½¿ç”¨ã€‚

### ä½¿ç”¨ ts-goï¼ˆæ¨èï¼‰

å®‰è£… VSCode æ’ä»¶ï¼š[TypeScript Native Preview](https://marketplace.visualstudio.com/items?itemName=TypeScriptTeam.native-preview)

> **æ³¨æ„**ï¼šç›®å‰ ts-go ä»…ç”¨äºç±»å‹æ£€æŸ¥å’Œè¯­è¨€æœåŠ¡ï¼Œå¼€å‘å’Œæ‰“åŒ…åŸºäº Vite (Rolldown)ï¼Œè¿è¡Œæ—¶ä½¿ç”¨ tsxã€‚

> **ç¼“å­˜é—®é¢˜**ï¼šå¦‚æœé‡åˆ° ts æœåŠ¡æŠ¥é”™æˆ–ç±»å‹ç¼“å­˜å¼‚å¸¸ï¼Œä½¿ç”¨ `Cmd + Shift + P` æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥ `restart`ï¼Œæ‰¾åˆ° **TypeScript: Restart TS Server** é‡å¯ TS æœåŠ¡å³å¯æ¢å¤æ­£å¸¸ã€‚

> **æ€§èƒ½æç¤º**ï¼šZod å¯¹ç±»å‹æœåŠ¡çš„æ€§èƒ½æ¶ˆè€—è¾ƒå¤§ï¼Œts-go åœ¨è¿™æ–¹é¢æœ‰æ˜æ˜¾æ”¹å–„ã€‚å¦‚æœèƒ½æ¥å—å¶å°”çš„ç¼“å­˜é—®é¢˜ï¼Œä»ç„¶å»ºè®®ç»§ç»­ä½¿ç”¨ ts-go ä»¥è·å¾—æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚

### ä¸ä½¿ç”¨ ts-go

å¦‚æœä¸å¸Œæœ›ä½¿ç”¨ ts-goï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤å›é€€ï¼š

1. ç§»é™¤ `.vscode/settings.json` é‡Œçš„ `"typescript.experimental.useTsgo": true`
2. æ‰§è¡Œ `pnpm remove @typescript/native-preview`
3. ä¿®æ”¹ `package.json` ä¸­çš„ `typecheck` å‘½ä»¤ï¼Œå°† `npx tsgo` æ”¹ä¸º `tsc`

## å¼€å‘è§„èŒƒ

æœ¬é¡¹ç›®é‡‡ç”¨ **è§„èŒƒé©±åŠ¨å¼€å‘ï¼ˆSpec-Driven Development, SDDï¼‰** æ–¹æ³•è®ºã€‚SDD é¢ è¦†äº†ä¼ ç»Ÿçš„å¼€å‘å±‚çº§å…³ç³»â€”â€”è®©è§„èŒƒæˆä¸ºä¸»å¯¼ï¼Œä»£ç æˆä¸ºè§„èŒƒçš„å®ç°ã€‚é€šè¿‡ AI èƒ½åŠ›ï¼Œç²¾ç¡®çš„è§„èŒƒå¯ä»¥ç›´æ¥ç”Ÿæˆå¯å·¥ä½œçš„ä»£ç ï¼ŒåŒæ—¶é€šè¿‡ç»“æ„åŒ–æµç¨‹é¿å…æ··ä¹±ã€‚

> ğŸ“– å»¶ä¼¸é˜…è¯»ï¼š[Spec-Driven Development](https://github.com/github/spec-kit/blob/main/spec-driven.md)

### Claude Code å¼€å‘æµç¨‹

éµå¾ª 6 é˜¶æ®µæ ‡å‡†æµç¨‹ï¼š`Spec â†’ ç”Ÿæˆä»£ç  â†’ ç”Ÿæˆæµ‹è¯• â†’ å¾ªç¯ä¼˜åŒ– â†’ æ¨¡å—æ–‡æ¡£`

| é˜¶æ®µ       | è¾“å‡º                                               |
| ---------- | -------------------------------------------------- |
| Spec       | `docs/{feature}/spec.md`ï¼ˆéœ€æ±‚ã€æ¶æ„ã€æµ‹è¯•ç­–ç•¥ï¼‰   |
| ç”Ÿæˆä»£ç    | å®Œæ•´æ¥å£ä»£ç ï¼ˆSchema + Handlersï¼‰+ migration       |
| ç”Ÿæˆæµ‹è¯•   | `__tests__/int.test.ts`                            |
| å¾ªç¯ä¼˜åŒ–   | æŒç»­æ”¹è¿›ç›´åˆ°é€šè¿‡éªŒæ”¶                               |
| æ¨¡å—æ–‡æ¡£   | `docs/{feature}/module.md`ï¼ˆæ–‡ä»¶ç´¢å¼•ã€åŠŸèƒ½ã€è¦ç‚¹ï¼‰ |

**éªŒæ”¶æ ‡å‡†**ï¼šæ‰€æœ‰æµ‹è¯•é€šè¿‡ + ç¬¦åˆ CLAUDE.md è§„èŒƒ + æ— æ˜æ˜¾æ€§èƒ½é—®é¢˜

---

### è·¯ç”±æ¨¡å—ç»“æ„

```text
routes/{tier}/{feature}/
â”œâ”€â”€ {feature}.handlers.ts       # ä¸šåŠ¡å¤„ç†å™¨ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ {feature}.routes.ts         # è·¯ç”±å®šä¹‰ + OpenAPIï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ {feature}.index.ts          # ç»Ÿä¸€å¯¼å‡ºï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ {feature}.types.ts          # ç±»å‹å®šä¹‰ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ {feature}.schema.ts         # è·¯ç”±çº§ Zod Schemaï¼ˆå¯é€‰ï¼Œå¤æ‚ Schema æ—¶ï¼‰
â”œâ”€â”€ {feature}.services.ts       # æœåŠ¡å‡½æ•°ï¼ˆå¯é€‰ï¼Œå¤æ‚é€»è¾‘æˆ–æ¨¡å—å†…å¤ç”¨ï¼‰
â”œâ”€â”€ {feature}.helpers.ts        # è¾…åŠ©å‡½æ•°ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ __tests__/                  # æµ‹è¯•ç›®å½•ï¼ˆæ¨èï¼‰
```

è·¨å±‚çº§å¤ç”¨çš„æœåŠ¡æ”¾åœ¨ `src/services/{service}/`

### æ•°æ®åº“æ¶æ„

```text
src/db/schema/
â”œâ”€â”€ _shard/                     # å…±äº«åŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ base-columns.ts         # é€šç”¨å­—æ®µï¼ˆid/createdAt/updatedAtç­‰ï¼‰
â”‚   â””â”€â”€ enums.ts                # PostgreSQL æšä¸¾å®šä¹‰
â”œâ”€â”€ {tier}/{feature}/           # ä¸šåŠ¡è¡¨å®šä¹‰ï¼ˆæŒ‰å±‚çº§å’ŒåŠŸèƒ½ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ {entity}.ts             # Drizzle è¡¨å®šä¹‰
â”‚   â””â”€â”€ index.ts                # è¯¥åŠŸèƒ½æ¨¡å—çš„è¡¨å¯¼å‡º
â””â”€â”€ index.ts                    # æ ¹å¯¼å‡ºï¼ˆæ±‡æ€»æ‰€æœ‰ schemaï¼‰
```

**ç›®å½•è¯´æ˜:**

- **`_shard/` ç›®å½•**: å­˜æ”¾è·¨åŠŸèƒ½çš„å…±äº«åŸºç¡€ç»„ä»¶
  - `base-columns.ts`: å¯¼å‡º `baseColumns` å¯¹è±¡ï¼Œæ‰€æœ‰è¡¨é€šè¿‡ `...baseColumns` æ‰©å±•
  - `enums.ts`: ä½¿ç”¨ `pgEnum()` å®šä¹‰æ•°æ®åº“æšä¸¾ç±»å‹

- **ä¸šåŠ¡è¡¨ç»„ç»‡**: æŒ‰ `{tier}/{feature}` åˆ†å±‚ï¼ˆå¦‚ `admin/system/users.ts`ï¼‰ï¼Œä¸è·¯ç”±ç»“æ„å¯¹åº”

### Zod Schema åˆ†å±‚

- **DB å±‚**ï¼ˆ`db/schema/{entity}.ts`ï¼‰ï¼šé€šè¿‡ `createSelectSchema` / `createInsertSchema` ä» Drizzle è¡¨å®šä¹‰ç”ŸæˆåŸºç¡€ Schemaï¼Œ`.meta({ description })` ä»…åœ¨æ­¤å±‚æ·»åŠ 
- **è·¯ç”±å±‚**ï¼ˆ`routes/{tier}/{feature}/*.schema.ts`ï¼‰ï¼šç»§æ‰¿ DB Schema è¿›è¡Œ pick/omit/extend ç»„åˆï¼Œæ¨èç”¨ `z.ZodType<Interface>` çº¦æŸç±»å‹å®‰å…¨
- ç®€å• CRUD å¯ç›´æ¥åœ¨ `routes.ts` ä¸­ä½¿ç”¨ DB Schemaï¼Œæ— éœ€å•ç‹¬ schema æ–‡ä»¶

```typescript
// DB å±‚ï¼šç”ŸæˆåŸºç¡€ Schema
export const selectUserSchema = createSelectSchema(users, {
  username: schema => schema.meta({ description: "ç”¨æˆ·å" }),
});
// è·¯ç”±å±‚ï¼šç»„åˆä¸šåŠ¡ Schema
export const createUserRequestSchema: z.ZodType<CreateUserRequest>
  = insertUserSchema.pick({ username: true, email: true });
```

**PostgreSQL ç‰ˆæœ¬è¯´æ˜**:

- **PostgreSQL 18 åŠä»¥ä¸Š**: æ— éœ€ä»»ä½•ä¿®æ”¹,ç›´æ¥ä½¿ç”¨å³å¯ã€‚é¡¹ç›®é»˜è®¤ä½¿ç”¨ PostgreSQL 18 çš„ `uuidv7()` å‡½æ•°ã€‚
- **PostgreSQL 18 ä»¥ä¸‹**: éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ `src/db/schema/_shard/base-columns.ts` æ–‡ä»¶:
  1. å®‰è£… `uuid` åº“:
     ```bash
     pnpm add uuid
     pnpm add -D @types/uuid
     ```
  2. ä¿®æ”¹ `base-columns.ts` æ–‡ä»¶,åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥:
     ```typescript
     import { uuidV7 } from "uuid";
     ```
  3. ä¿®æ”¹ `id` å­—æ®µå®šä¹‰:
     ```typescript
     // å°†
     uuid().primaryKey().notNull().default(sql`uuidv7()`);
     // æ”¹ä¸º
     uuid().primaryKey().notNull().$defaultFn(() => uuidV7());
     ```

### æ¶æ„ç­–ç•¥

**ç®€å• CRUDï¼ˆ80%ï¼‰**ï¼šHandler ç›´æ¥æ“ä½œ Drizzleï¼ŒæŒ‰éœ€æŠ½ç¦»æœåŠ¡å±‚ã€‚**å¤æ‚ä¸šåŠ¡ï¼ˆ20%ï¼‰**ï¼šæ ¹æ®åœºæ™¯é€‰æ‹© DDD / å…­è¾¹å½¢æ¶æ„ï¼ŒDomain å±‚çº¯å‡€ä¸ä¾èµ–å¤–éƒ¨ï¼Œé€šè¿‡ Port/Adapter ä¾èµ–åè½¬ã€‚

```text
src/domain/[module]/                     # é¢†åŸŸå±‚ï¼ˆçº¯ä¸šåŠ¡é€»è¾‘ï¼‰
â”œâ”€â”€ [module].entity.ts                   # é¢†åŸŸå®ä½“
â”œâ”€â”€ [module].service.ts                  # é¢†åŸŸæœåŠ¡
â””â”€â”€ [module].repository.port.ts          # ä»“å‚¨æ¥å£ï¼ˆPortï¼‰
src/infrastructure/persistence/          # åŸºç¡€è®¾æ–½å±‚ï¼ˆAdapter å®ç°ï¼‰
```

## æ ¸å¿ƒæ¶æ„ç‰¹æ€§

### ğŸ”„ è‡ªåŠ¨è·¯ç”±åŠ è½½

åŸºäº `import.meta.glob` è‡ªåŠ¨æ‰«æ `routes/{tier}/**/*.index.ts` å¹¶æ³¨å†Œè·¯ç”±æ¨¡å—ã€‚æ–°å¢æ¨¡å—åªéœ€åˆ›å»ºç›®å½•ï¼Œä¿å­˜å HMR æ¯«ç§’çº§ç”Ÿæ•ˆã€‚æ¯ä¸ªæ¨¡å—å¿…é¡»åœ¨ `{feature}.index.ts` ä¸­ `export default` è·¯ç”±å®ä¾‹ã€‚

### ğŸ§© å•ä¾‹ç®¡ç†ç³»ç»Ÿ

ç»Ÿä¸€ç®¡ç† PostgreSQLã€Redisã€Casbin ç­‰é•¿è¿æ¥èµ„æºï¼Œè§£å†³ Vite HMR æ¨¡å¼ä¸‹çš„è¿æ¥æ³„æ¼é—®é¢˜ï¼Œæ”¯æŒè‡ªåŠ¨èµ„æºæ¸…ç†

#### æ ¸å¿ƒæ€è·¯

**æƒé™ç³»ç»Ÿ**:åŸºäº RESTful API è·¯å¾„ + Casbin KeyMatch3,ä»£ç å³æƒé™,æ— éœ€æ•°æ®åº“å­˜å‚¨æƒé™æ ‡è¯†
**èœå•ç³»ç»Ÿ**:Refine Resource ç¼–è¯‘æ—¶è·¯ç”±,è¿è¡Œæ—¶é›¶å¼€é”€,ä»£ç å³èœå•
**å­—å…¸ç³»ç»Ÿ**:TypeScript æšä¸¾ â†’ PostgreSQL Enum â†’ OpenAPI è‡ªåŠ¨ç”Ÿæˆ,å‰åç«¯ 100% åŒæ­¥

#### å¯¹æ¯”ä¼ ç»Ÿæ–¹æ¡ˆ

| ç»´åº¦     | æœ¬é¡¹ç›®æ–¹æ¡ˆ                                 | ä¼ ç»Ÿæ–¹æ¡ˆ                                     |
| -------- | ------------------------------------------ | -------------------------------------------- |
| **æƒé™** | OpenAPI è·¯ç”±å®šä¹‰,Casbin ç­–ç•¥åŒ¹é…,è‡ªåŠ¨åŒæ­¥  | æ•°æ®åº“æƒé™è¡¨ + å…³è”è¡¨,æ‰‹åŠ¨ç»´æŠ¤,å®¹æ˜“ä¸ä¸€è‡´    |
| **èœå•** | ç¼–è¯‘æ—¶ç”Ÿæˆè·¯ç”±æ ‘,ç±»å‹å®‰å…¨,é›¶è¿è¡Œæ—¶å¼€é”€     | æ•°æ®åº“å­˜å‚¨èœå•,è¿è¡Œæ—¶æŸ¥è¯¢è§£æ,éœ€è¦ç®¡ç†ç•Œé¢   |
| **å­—å…¸** | å•ä¸€æ•°æ®æº,ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥,4 å­—èŠ‚ Enum å­˜å‚¨ | æ•°æ®åº“å­—å…¸è¡¨,è¿è¡Œæ—¶æŸ¥è¯¢,éœ€è¦ JOIN,å®¹æ˜“ä¸åŒæ­¥ |
| **ç»´æŠ¤** | æ”¹ä¸€å¤„è‡ªåŠ¨åŒæ­¥,TypeScript ç¼–è¯‘æ—¶æŠ¥é”™       | å¤šå¤„æ‰‹åŠ¨åŒæ­¥:æ•°æ®åº“ â†’ åç«¯ â†’ å‰ç«¯ â†’ æ–‡æ¡£     |

### ğŸ“ æ—¥å¿—ç³»ç»Ÿ

åŸºäº pino transport æ¶æ„ï¼Œæ”¯æŒå¤šç›®æ ‡è¾“å‡ºï¼ˆå¼€å‘ `pino-pretty` / ç”Ÿäº§ stdout JSON / å¯é€‰é˜¿é‡Œäº‘ SLSï¼‰ã€‚ä¸‰ç§ child logger è‡ªåŠ¨æ³¨å…¥ `type` å­—æ®µï¼š`logger`ï¼ˆç³»ç»Ÿï¼‰ã€`operationLogger`ï¼ˆCRUD å®¡è®¡ï¼Œtype: `OPERATION`ï¼‰ã€`loginLogger`ï¼ˆç™»å½•è®°å½•ï¼Œtype: `LOGIN`ï¼‰ã€‚

æ“ä½œæ—¥å¿—ä¸­é—´ä»¶å·²åœ¨ admin tier å…¨å±€é…ç½®ï¼ˆæ— å‚æ•°æ¨¡å¼å­˜å‚¨åŸå§‹ `urlPath`ï¼‰ï¼Œä¹Ÿæ”¯æŒå±€éƒ¨æ¨¡å¼æ‰‹åŠ¨æŒ‡å®šæ¨¡å—åï¼š

```typescript
router.use(operationLog({ moduleName: "è®¢å•ç®¡ç†", description: "åˆ›å»ºè®¢å•" }));
```

è‡ªå®šä¹‰ Transport æ¥å…¥ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `transports/sls-transport.mjs`ï¼Œä½¿ç”¨ `pino-abstract-transport` æ„å»ºï¼Œç„¶ååœ¨ `logger.ts` çš„ `buildTransportTargets()` ä¸­å–æ¶ˆæ³¨é‡Š SLS targetã€‚æ“ä½œæ—¥å¿— `urlPath` ä¸ Casbin keymatch3 è§„åˆ™å’Œ Refine resource å¤©ç„¶å¯¹åº”ï¼Œå‰ç«¯å¯ç›´æ¥ç”¨æƒé™æ ‘æ˜ å°„ä¸­æ–‡æ ‡ç­¾ä½œä¸ºæ—¥å¿—ç­›é€‰ç»´åº¦ã€‚

## éƒ¨ç½²

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t clhoria-template .

# è¿è¡Œå®¹å™¨
docker run -p 9999:9999 --env-file .env clhoria-template
```

## éƒ¨ç½²ç‰¹æ€§

**å¯é€‰ SaaS ä¾èµ–**: sentryã€Cloudflare R2 å¯¹è±¡å­˜å‚¨ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡å‡ä¸ºå¯é€‰,å¯å®Œå…¨éƒ¨ç½²åœ¨å†…ç½‘ç¯å¢ƒã€‚æŠ€æœ¯æ ˆç¬¦åˆä¿¡åˆ›è¦æ±‚,æ”¯æŒè¿ç§»è‡³å›½äº§æ•°æ®åº“(å¦‚äººå¤§é‡‘ä»“ã€åä¸ºé«˜æ–¯ç­‰)ã€‚

## å¼€å‘ä½“éªŒå¯¹æ¯”

| å¯¹æ¯”ç»´åº¦     | æœ¬é¡¹ç›® (AI + Modern Stack)                      | ä¼ ç»Ÿä»£ç ç”Ÿæˆå™¨                           |
| ------------ | ----------------------------------------------- | ---------------------------------------- |
| **å¼€å‘æ•ˆç‡** | Claude Code æ™ºèƒ½ç†è§£éœ€æ±‚,ç§’çº§ç”Ÿæˆç¬¦åˆè§„èŒƒçš„ä»£ç  | æ‰‹åŠ¨é…ç½®æ¨¡æ¿éº»çƒ¦,ç”ŸæˆåƒµåŒ–ä»£ç ,éœ€å¤§é‡ä¿®æ”¹ |
| **æ¥å£ç®¡ç†** | OpenAPI + Zod è‡ªåŠ¨åŒæ­¥,ç±»å‹å®‰å…¨,æ–‡æ¡£æ°¸ä¸è¿‡æœŸ    | æ‰‹å·¥ç»´æŠ¤æ¥å£æ–‡æ¡£,å®¹æ˜“ä¸åŒæ­¥              |
| **ä»£ç è´¨é‡** | TypeScript å…¨é“¾è·¯ç±»å‹æ£€æŸ¥,ç¼–è¯‘æ—¶å‘ç°é—®é¢˜        | ç”Ÿæˆä»£ç ç¼ºä¹ç±»å‹çº¦æŸ,è¿è¡Œæ—¶é”™è¯¯é¢‘å‘      |
| **ç»´æŠ¤æˆæœ¬** | ä»£ç è§„èŒƒç»Ÿä¸€,AI ç†è§£é¡¹ç›®æ¶æ„,ç»´æŠ¤ç®€å•           | ä»£ç é‡å¤§ä¸å¤Ÿä¼˜é›…,ä¸å¥½ç»´æŠ¤                |

## éªŒè¯ç ç³»ç»Ÿå¯¹æ¯”

### ğŸ” Cap.js vs svg-captcha

| å¯¹æ¯”ç»´åº¦     | Cap.js (æœ¬é¡¹ç›®é‡‡ç”¨)                          | svg-captcha                    |
| ------------ | -------------------------------------------- | ------------------------------ |
| **å®‰å…¨æ€§**   | SHA-256 å·¥ä½œé‡è¯æ˜,æ— è§†è§‰ç ´è§£é¢,æŠ—è‡ªåŠ¨åŒ–     | åŸºäºå›¾åƒè¯†åˆ«,æ˜“è¢« OCR å·¥å…·ç ´è§£ |
| **ç”¨æˆ·ä½“éªŒ** | æ— è§†è§‰è°œé¢˜,åå°é™é»˜è®¡ç®—,æ”¯æŒ Widget/éšå½¢æ¨¡å¼ | ä¼ ç»Ÿå›¾ç‰‡éªŒè¯,è¯†åˆ«æ‰­æ›²æ–‡å­—      |
| **éšç§**     | è‡ªæ‰˜ç®¡,é›¶è¿½è¸ªé›¶é¥æµ‹,å®Œå…¨æŒæ§æ•°æ®             | å†…å­˜å­˜å‚¨,åŠŸèƒ½å›ºå®š              |

## æ€§èƒ½å¯¹æ¯”

### Hono vs Fastify æ€§èƒ½åˆ†æ

åœ¨ Node.js 22 ç¯å¢ƒä¸‹,Fastify ä¾ç„¶ä¿æŒæ€§èƒ½ä¼˜åŠ¿,ä½†å·®è·å·²ç»ä¸å¤§:

- **Fastify (Node.js)**: 142,695 req/s
- **Hono (Node.js)**: 129,234 req/s

è¯¦ç»†åŸºå‡†æµ‹è¯•:[bun-http-framework-benchmark](https://github.com/SaltyAom/bun-http-framework-benchmark)

### ğŸš€ é«˜å¹¶å‘ä¸æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

**é«˜å¹¶å‘è§£å†³æ–¹æ¡ˆ**:K8s/é˜¿é‡Œäº‘ SLB è´Ÿè½½å‡è¡¡ + PostgreSQL/Redis é«˜å¯ç”¨é›†ç¾¤ + åˆ†å¸ƒå¼ä¼šè¯,å®ç°æ— çŠ¶æ€æ°´å¹³æ‰©å±•

**è®¡ç®—å¯†é›†å‹ä¼˜åŒ–**:

| åœºæ™¯             | æ¨èæ–¹æ¡ˆ       | é€‚ç”¨åœºæ™¯                       |
| ---------------- | -------------- | ------------------------------ |
| **å¤šæ¬¡é‡å¤è°ƒç”¨** | napi-rs        | å›¾åƒå¤„ç†ã€åŠ å¯†è§£å¯†ã€æ•°æ®å‹ç¼©   |
| **å•æ¬¡å¯†é›†è®¡ç®—** | WASM           | å¤æ‚ç®—æ³•ã€ç§‘å­¦è®¡ç®—ã€å•æ¬¡é‡è®¡ç®— |
| **å¹¶è¡Œå¤šä»»åŠ¡**   | Worker Threads | å¤§é‡ç‹¬ç«‹ä»»åŠ¡ã€å¹¶å‘æ•°æ®å¤„ç†     |

## Claude Code æ·±åº¦é›†æˆ(å¯é€‰)

æœ¬é¡¹ç›®ä¸“ä¸º AI é©±åŠ¨å¼€å‘è€Œè®¾è®¡,æä¾›å®Œæ•´çš„ CLAUDE.md é…ç½®,è®© AI æ·±åº¦ç†è§£é¡¹ç›®æ¶æ„ã€‚

**æ¨è MCP æ’ä»¶**:

- **[Serena](https://github.com/SerenaAI/serena-mcp)**:æ™ºèƒ½ä»£ç åˆ†æå’Œé‡æ„å»ºè®®
- **[Context7](https://github.com/context7/mcp-plugin)**:å®æ—¶æŠ€æœ¯æ–‡æ¡£æŸ¥è¯¢å’Œä»£ç ç¤ºä¾‹

## VSCode ä»£ç ç‰‡æ®µ

é¡¹ç›®å†…ç½®äº† CRUD å¼€å‘å¸¸ç”¨çš„ä»£ç ç‰‡æ®µæ¨¡æ¿ï¼ˆ`.vscode/crud.code-snippets`ï¼‰ï¼Œåœ¨ TypeScript æ–‡ä»¶ä¸­è¾“å…¥å‰ç¼€åæŒ‰ `Tab` é”®å³å¯å¿«é€Ÿç”Ÿæˆä»£ç ã€‚

| å‰ç¼€            | è¯´æ˜                                          |
| --------------- | --------------------------------------------- |
| `crud-schema`   | å®Œæ•´ schema.ts æ¨¡æ¿                           |
| `crud-routes`   | å®Œæ•´ routes.ts æ¨¡æ¿ï¼ˆå« CRUD äº”ä¸ªè·¯ç”±ï¼‰       |
| `crud-handlers` | å®Œæ•´ handlers.ts æ¨¡æ¿ï¼ˆå« CRUD äº”ä¸ªå¤„ç†å‡½æ•°ï¼‰ |
| `crud-index`    | å®Œæ•´ index.ts æ¨¡æ¿                            |

## æµ‹è¯•

ä½¿ç”¨ Vitest æµ‹è¯•æ¡†æ¶,æ”¯æŒå®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•,å¯ä»¥åœ¨ tests ä¸‹æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•ã€‚

```bash
# è¿è¡Œæµ‹è¯•
pnpm test
```

## å¼•ç”¨

- [hono-open-api-starter](https://github.com/w3cj/hono-open-api-starter)
- [stoker](https://github.com/w3cj/stoker)

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,è¯·åˆ›å»º [Issue](https://github.com/zhe-qi/clhoria-template/issues) æˆ–è”ç³»ç»´æŠ¤è€…ã€‚

**QQ äº¤æµç¾¤**: 1076889416

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®!è¯·éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒ,æäº¤ PR å‰ç¡®ä¿ `pnpm test` å’Œ `pnpm lint` é€šè¿‡ã€‚

## è®¸å¯è¯

MIT License - æŸ¥çœ‹ [LICENSE](https://github.com/zhe-qi/clhoria-template/blob/main/LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚
